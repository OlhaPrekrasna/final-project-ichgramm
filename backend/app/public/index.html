<!DOCTYPE html>
<html>
  <head>
    <title>Test Socket.IO Chat</title>
    <script src="https://cdn.socket.io/4.7.1/socket.io.min.js"></script>
  </head>
  <body>
    <input id="targetUserId" placeholder="Target User ID" />
    <input id="messageText" placeholder="Message" />
    <button id="joinBtn">Join Room</button>
    <button id="sendBtn">Send Message</button>
    <div id="room"></div>
    <div id="messages"></div>

    <script>
      const token =
        'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6IjY4ZDUwMDU5N2RmNWIzNjI5YTFlOWM2ZSIsImlhdCI6MTc1OTE3MzA3MCwiZXhwIjoxNzU5Nzc3ODcwfQ.Jm2AzcDx2zY-fSdiMJhQl8HZNZvF-eYQ-pzvGzJSEtE';

      const socket = io('http://localhost:3001', {
        auth: { token },
      });

      socket.on('connect', () => {
        console.log('Connected to socket.io');
      });

      socket.on('loadMessages', ({ roomId, messages }) => {
        const roomDiv = document.getElementById('room');
        roomDiv.innerHTML = `<h3>Room: ${roomId}</h3>`;

        const messagesDiv = document.getElementById('messages');
        messages.forEach((msg) => {
          messagesDiv.innerHTML += `<p><b>${msg.sender_id.username}</b>: ${msg.text_of_message}</p>`;
        });
      });

      socket.on('newMessage', (msg) => {
        const messagesDiv = document.getElementById('messages');
        messagesDiv.innerHTML =
          `<p><b>${msg.sender_id.username}</b>: ${msg.text_of_message}</p>` +
          messagesDiv.innerHTML;
      });

      document.getElementById('joinBtn').onclick = () => {
        const targetUserId = document.getElementById('targetUserId').value;
        if (!targetUserId) {
          window.alert('Recipient ID is required!');
          return;
        }

        socket.emit('joinRoom', { targetUserId });
      };

      document.getElementById('sendBtn').onclick = () => {
        const targetUserId = document.getElementById('targetUserId').value;
        if (!targetUserId) {
          window.alert('Recipient ID is required!');
          return;
        }

        const messageText = document.getElementById('messageText').value;
        if (!messageText) {
          window.alert('Message text is required!');
          return;
        }

        socket.emit('sendMessage', { targetUserId, messageText });
        console.log('Message has been sent');

        document.getElementById('messageText').value = '';
      };
    </script>
  </body>
</html>
